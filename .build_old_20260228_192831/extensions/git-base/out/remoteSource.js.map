{"version":3,"file":"remoteSource.js","sourceRoot":"","sources":["../src/remoteSource.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\n\r\nimport { QuickPickItem, window, QuickPick, QuickPickItemKind, l10n, Disposable } from 'vscode';\r\nimport { RemoteSourceProvider, RemoteSource, PickRemoteSourceOptions, PickRemoteSourceResult, RemoteSourceAction } from './api/git-base';\r\nimport { Model } from './model';\r\nimport { throttle, debounce } from './decorators';\r\n\r\nasync function getQuickPickResult<T extends QuickPickItem>(quickpick: QuickPick<T>): Promise<T | undefined> {\r\n\tconst listeners: Disposable[] = [];\r\n\tconst result = await new Promise<T | undefined>(c => {\r\n\t\tlisteners.push(\r\n\t\t\tquickpick.onDidAccept(() => c(quickpick.selectedItems[0])),\r\n\t\t\tquickpick.onDidHide(() => c(undefined)),\r\n\t\t);\r\n\t\tquickpick.show();\r\n\t});\r\n\r\n\tquickpick.hide();\r\n\tlisteners.forEach(l => l.dispose());\r\n\treturn result;\r\n}\r\n\r\nclass RemoteSourceProviderQuickPick implements Disposable {\r\n\r\n\tprivate disposables: Disposable[] = [];\r\n\tprivate isDisposed: boolean = false;\r\n\r\n\tprivate quickpick: QuickPick<QuickPickItem & { remoteSource?: RemoteSource }> | undefined;\r\n\r\n\tconstructor(private provider: RemoteSourceProvider) { }\r\n\r\n\tdispose() {\r\n\t\tthis.disposables.forEach(d => d.dispose());\r\n\t\tthis.disposables = [];\r\n\t\tthis.quickpick = undefined;\r\n\t\tthis.isDisposed = true;\r\n\t}\r\n\r\n\tprivate ensureQuickPick() {\r\n\t\tif (!this.quickpick) {\r\n\t\t\tthis.quickpick = window.createQuickPick();\r\n\t\t\tthis.disposables.push(this.quickpick);\r\n\t\t\tthis.quickpick.ignoreFocusOut = true;\r\n\t\t\tthis.disposables.push(this.quickpick.onDidHide(() => this.dispose()));\r\n\t\t\tif (this.provider.supportsQuery) {\r\n\t\t\t\tthis.quickpick.placeholder = this.provider.placeholder ?? l10n.t('Repository name (type to search)');\r\n\t\t\t\tthis.disposables.push(this.quickpick.onDidChangeValue(this.onDidChangeValue, this));\r\n\t\t\t} else {\r\n\t\t\t\tthis.quickpick.placeholder = this.provider.placeholder ?? l10n.t('Repository name');\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t@debounce(300)\r\n\tprivate onDidChangeValue(): void {\r\n\t\tthis.query();\r\n\t}\r\n\r\n\t@throttle\r\n\tprivate async query(): Promise<void> {\r\n\t\ttry {\r\n\t\t\tif (this.isDisposed) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.ensureQuickPick();\r\n\t\t\tthis.quickpick!.busy = true;\r\n\t\t\tthis.quickpick!.show();\r\n\r\n\t\t\tconst remoteSources = await this.provider.getRemoteSources(this.quickpick?.value) || [];\r\n\t\t\t// The user may have cancelled the picker in the meantime\r\n\t\t\tif (this.isDisposed) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (remoteSources.length === 0) {\r\n\t\t\t\tthis.quickpick!.items = [{\r\n\t\t\t\t\tlabel: l10n.t('No remote repositories found.'),\r\n\t\t\t\t\talwaysShow: true\r\n\t\t\t\t}];\r\n\t\t\t} else {\r\n\t\t\t\tthis.quickpick!.items = remoteSources.map(remoteSource => ({\r\n\t\t\t\t\tlabel: remoteSource.icon ? `$(${remoteSource.icon}) ${remoteSource.name}` : remoteSource.name,\r\n\t\t\t\t\tdescription: remoteSource.description || (typeof remoteSource.url === 'string' ? remoteSource.url : remoteSource.url[0]),\r\n\t\t\t\t\tdetail: remoteSource.detail,\r\n\t\t\t\t\tremoteSource,\r\n\t\t\t\t\talwaysShow: true\r\n\t\t\t\t}));\r\n\t\t\t}\r\n\t\t} catch (err) {\r\n\t\t\tthis.quickpick!.items = [{ label: l10n.t('{0} Error: {1}', '$(error)', err.message), alwaysShow: true }];\r\n\t\t\tconsole.error(err);\r\n\t\t} finally {\r\n\t\t\tif (!this.isDisposed) {\r\n\t\t\t\tthis.quickpick!.busy = false;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tasync pick(): Promise<RemoteSource | undefined> {\r\n\t\tawait this.query();\r\n\t\tif (this.isDisposed) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst result = await getQuickPickResult(this.quickpick!);\r\n\t\treturn result?.remoteSource;\r\n\t}\r\n}\r\n\r\nexport async function getRemoteSourceActions(model: Model, url: string): Promise<RemoteSourceAction[]> {\r\n\tconst providers = model.getRemoteProviders();\r\n\r\n\tconst remoteSourceActions = [];\r\n\tfor (const provider of providers) {\r\n\t\tconst providerActions = await provider.getRemoteSourceActions?.(url);\r\n\t\tif (providerActions?.length) {\r\n\t\t\tremoteSourceActions.push(...providerActions);\r\n\t\t}\r\n\t}\r\n\r\n\treturn remoteSourceActions;\r\n}\r\n\r\nexport async function pickRemoteSource(model: Model, options: PickRemoteSourceOptions): Promise<string | PickRemoteSourceResult | undefined>;\r\nexport async function pickRemoteSource(model: Model, options: PickRemoteSourceOptions & { branch?: false | undefined }): Promise<string | undefined>;\r\nexport async function pickRemoteSource(model: Model, options: PickRemoteSourceOptions & { branch: true }): Promise<PickRemoteSourceResult | undefined>;\r\nexport async function pickRemoteSource(model: Model, options: PickRemoteSourceOptions = {}): Promise<string | PickRemoteSourceResult | undefined> {\r\n\tconst quickpick = window.createQuickPick<(QuickPickItem & { provider?: RemoteSourceProvider; url?: string })>();\r\n\tquickpick.title = options.title;\r\n\r\n\tif (options.providerName) {\r\n\t\tconst provider = model.getRemoteProviders()\r\n\t\t\t.filter(provider => provider.name === options.providerName)[0];\r\n\r\n\t\tif (provider) {\r\n\t\t\treturn await pickProviderSource(provider, options);\r\n\t\t}\r\n\t}\r\n\r\n\tconst remoteProviders = model.getRemoteProviders()\r\n\t\t.map(provider => ({ label: (provider.icon ? `$(${provider.icon}) ` : '') + (options.providerLabel ? options.providerLabel(provider) : provider.name), alwaysShow: true, provider }));\r\n\r\n\tconst recentSources: (QuickPickItem & { url?: string; timestamp: number })[] = [];\r\n\tif (options.showRecentSources) {\r\n\t\tfor (const { provider } of remoteProviders) {\r\n\t\t\tconst sources = (await provider.getRecentRemoteSources?.() ?? []).map((item) => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\t...item,\r\n\t\t\t\t\tlabel: (item.icon ? `$(${item.icon}) ` : '') + item.name,\r\n\t\t\t\t\turl: typeof item.url === 'string' ? item.url : item.url[0],\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\trecentSources.push(...sources);\r\n\t\t}\r\n\t}\r\n\r\n\tconst items = [\r\n\t\t{ kind: QuickPickItemKind.Separator, label: l10n.t('remote sources') },\r\n\t\t...remoteProviders,\r\n\t\t{ kind: QuickPickItemKind.Separator, label: l10n.t('recently opened') },\r\n\t\t...recentSources.sort((a, b) => b.timestamp - a.timestamp)\r\n\t];\r\n\r\n\tquickpick.placeholder = options.placeholder ?? (remoteProviders.length === 0\r\n\t\t? l10n.t('Provide repository URL')\r\n\t\t: l10n.t('Provide repository URL or pick a repository source.'));\r\n\r\n\tconst updatePicks = (value?: string) => {\r\n\t\tif (value) {\r\n\t\t\tconst label = (typeof options.urlLabel === 'string' ? options.urlLabel : options.urlLabel?.(value)) ?? l10n.t('URL');\r\n\t\t\tquickpick.items = [{\r\n\t\t\t\tlabel: label,\r\n\t\t\t\tdescription: value,\r\n\t\t\t\talwaysShow: true,\r\n\t\t\t\turl: value\r\n\t\t\t},\r\n\t\t\t...items\r\n\t\t\t];\r\n\t\t} else {\r\n\t\t\tquickpick.items = items;\r\n\t\t}\r\n\t};\r\n\r\n\tquickpick.onDidChangeValue(updatePicks);\r\n\tupdatePicks();\r\n\r\n\tconst result = await getQuickPickResult(quickpick);\r\n\r\n\tif (result) {\r\n\t\tif (result.url) {\r\n\t\t\treturn result.url;\r\n\t\t} else if (result.provider) {\r\n\t\t\treturn await pickProviderSource(result.provider, options);\r\n\t\t}\r\n\t}\r\n\r\n\treturn undefined;\r\n}\r\n\r\nasync function pickProviderSource(provider: RemoteSourceProvider, options: PickRemoteSourceOptions = {}): Promise<string | PickRemoteSourceResult | undefined> {\r\n\tconst quickpick = new RemoteSourceProviderQuickPick(provider);\r\n\tconst remote = await quickpick.pick();\r\n\tquickpick.dispose();\r\n\r\n\tlet url: string | undefined;\r\n\r\n\tif (remote) {\r\n\t\tif (typeof remote.url === 'string') {\r\n\t\t\turl = remote.url;\r\n\t\t} else if (remote.url.length > 0) {\r\n\t\t\turl = await window.showQuickPick(remote.url, { ignoreFocusOut: true, placeHolder: l10n.t('Choose a URL to clone from.') });\r\n\t\t}\r\n\t}\r\n\r\n\tif (!url || !options.branch) {\r\n\t\treturn url;\r\n\t}\r\n\r\n\tif (!provider.getBranches) {\r\n\t\treturn { url };\r\n\t}\r\n\r\n\tconst branches = await provider.getBranches(url);\r\n\r\n\tif (!branches) {\r\n\t\treturn { url };\r\n\t}\r\n\r\n\tconst branch = await window.showQuickPick(branches, {\r\n\t\tplaceHolder: l10n.t('Branch name')\r\n\t});\r\n\r\n\tif (!branch) {\r\n\t\treturn { url };\r\n\t}\r\n\r\n\treturn { url, branch };\r\n}\r\n"]}