{"version":3,"file":"decorators.js","sourceRoot":"","sources":["../src/decorators.ts"],"names":[],"mappings":";AAAA;;;gGAGgG;;;;AAEhG,iCAA8B;AAE9B,kBAAyB,KAAa,EAAY;IACjD,OAAO,QAAQ,CAAC,CAAC,EAAE,EAAE,GAAG,EAAE,EAAE,CAAC;QAC5B,MAAM,QAAQ,GAAG,aAAa,GAAG,EAAE,CAAC;QAEpC,OAAO,UAAqB,GAAG,IAAW,EAAE;YAC3C,YAAY,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC;YAC7B,IAAI,CAAC,QAAQ,CAAC,GAAG,UAAU,CAAC,GAAG,EAAE,CAAC,EAAE,CAAC,KAAK,CAAC,IAAI,EAAE,IAAI,CAAC,EAAE,KAAK,CAAC,CAAC;QAAA,CAC/D,CAAC;IAAA,CACF,CAAC,CAAC;AAAA,CACH;AAEY,QAAA,QAAQ,GAAG,QAAQ,CAAC,SAAS,CAAC,CAAC;AAE5C,SAAS,SAAS,CAAI,EAAY,EAAE,GAAW,EAAY;IAC1D,MAAM,UAAU,GAAG,qBAAqB,GAAG,EAAE,CAAC;IAC9C,MAAM,OAAO,GAAG,kBAAkB,GAAG,EAAE,CAAC;IAExC,MAAM,OAAO,GAAG,UAAqB,GAAG,IAAW,EAAE;QACpD,IAAI,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC;YACnB,OAAO,IAAI,CAAC,OAAO,CAAC,CAAC;QACtB,CAAC;QAED,IAAI,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC;YACtB,IAAI,CAAC,OAAO,CAAC,GAAG,IAAA,WAAI,EAAC,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,EAAE,CAAC;gBACjD,IAAI,CAAC,OAAO,CAAC,GAAG,SAAS,CAAC;gBAC1B,OAAO,OAAO,CAAC,KAAK,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;YAAA,CACjC,CAAC,CAAC;YAEH,OAAO,IAAI,CAAC,OAAO,CAAC,CAAC;QACtB,CAAC;QAED,IAAI,CAAC,UAAU,CAAC,GAAG,EAAE,CAAC,KAAK,CAAC,IAAI,EAAE,IAAI,CAAe,CAAC;QAEtD,MAAM,KAAK,GAAG,GAAG,EAAE,CAAC,IAAI,CAAC,UAAU,CAAC,GAAG,SAAS,CAAC;QACjD,IAAA,WAAI,EAAC,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC;QAE1C,OAAO,IAAI,CAAC,UAAU,CAAC,CAAC;IAAA,CACxB,CAAC;IAEF,OAAO,OAAO,CAAC;AAAA,CACf;AAED,SAAS,QAAQ,CAAC,SAAkD,EAAmB;IACtF,OAAO,CAAC,OAAY,EAAE,GAAoB,EAAE,UAA8B,EAAQ,EAAE,CAAC;QACpF,IAAI,OAAO,UAAU,CAAC,KAAK,KAAK,UAAU,EAAE,CAAC;YAC5C,MAAM,IAAI,KAAK,CAAC,eAAe,CAAC,CAAC;QAClC,CAAC;QACD,UAAU,CAAC,KAAK,GAAG,SAAS,CAAC,UAAU,CAAC,KAAK,EAAE,MAAM,CAAC,GAAG,CAAC,CAAC,CAAC;IAAA,CAC5D,CAAC;AAAA,CACF","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\n\r\nimport { done } from './util';\r\n\r\nexport function debounce(delay: number): Function {\r\n\treturn decorate((fn, key) => {\r\n\t\tconst timerKey = `$debounce$${key}`;\r\n\r\n\t\treturn function (this: any, ...args: any[]) {\r\n\t\t\tclearTimeout(this[timerKey]);\r\n\t\t\tthis[timerKey] = setTimeout(() => fn.apply(this, args), delay);\r\n\t\t};\r\n\t});\r\n}\r\n\r\nexport const throttle = decorate(_throttle);\r\n\r\nfunction _throttle<T>(fn: Function, key: string): Function {\r\n\tconst currentKey = `$throttle$current$${key}`;\r\n\tconst nextKey = `$throttle$next$${key}`;\r\n\r\n\tconst trigger = function (this: any, ...args: any[]) {\r\n\t\tif (this[nextKey]) {\r\n\t\t\treturn this[nextKey];\r\n\t\t}\r\n\r\n\t\tif (this[currentKey]) {\r\n\t\t\tthis[nextKey] = done(this[currentKey]).then(() => {\r\n\t\t\t\tthis[nextKey] = undefined;\r\n\t\t\t\treturn trigger.apply(this, args);\r\n\t\t\t});\r\n\r\n\t\t\treturn this[nextKey];\r\n\t\t}\r\n\r\n\t\tthis[currentKey] = fn.apply(this, args) as Promise<T>;\r\n\r\n\t\tconst clear = () => this[currentKey] = undefined;\r\n\t\tdone(this[currentKey]).then(clear, clear);\r\n\r\n\t\treturn this[currentKey];\r\n\t};\r\n\r\n\treturn trigger;\r\n}\r\n\r\nfunction decorate(decorator: (fn: Function, key: string) => Function): MethodDecorator {\r\n\treturn (_target: any, key: string | symbol, descriptor: PropertyDescriptor): void => {\r\n\t\tif (typeof descriptor.value !== 'function') {\r\n\t\t\tthrow new Error('not supported');\r\n\t\t}\r\n\t\tdescriptor.value = decorator(descriptor.value, String(key));\r\n\t};\r\n}\r\n"]}