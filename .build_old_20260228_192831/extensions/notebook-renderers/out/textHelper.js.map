{"version":3,"file":"textHelper.js","sourceRoot":"","sources":["../src/textHelper.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\n\r\nimport { handleANSIOutput } from './ansi';\r\nimport { LinkOptions } from './linkify';\r\nimport { OutputElementOptions, OutputWithAppend } from './rendererTypes';\r\nexport const scrollableClass = 'scrollable';\r\n\r\nconst softScrollableLineLimit = 5000;\r\nconst hardScrollableLineLimit = 8000;\r\n\r\n/**\r\n * Output is Truncated. View as a [scrollable element] or open in a [text editor]. Adjust cell output [settings...]\r\n */\r\nfunction generateViewMoreElement(outputId: string) {\r\n\r\n\tconst container = document.createElement('div');\r\n\tcontainer.classList.add('truncation-message');\r\n\tconst first = document.createElement('span');\r\n\tfirst.textContent = 'Output is truncated. View as a ';\r\n\tcontainer.appendChild(first);\r\n\r\n\tconst viewAsScrollableLink = document.createElement('a');\r\n\tviewAsScrollableLink.textContent = 'scrollable element';\r\n\tviewAsScrollableLink.href = `command:cellOutput.enableScrolling?${outputId}`;\r\n\tviewAsScrollableLink.ariaLabel = 'enable scrollable output';\r\n\tcontainer.appendChild(viewAsScrollableLink);\r\n\r\n\tconst second = document.createElement('span');\r\n\tsecond.textContent = ' or open in a ';\r\n\tcontainer.appendChild(second);\r\n\r\n\tconst openInTextEditorLink = document.createElement('a');\r\n\topenInTextEditorLink.textContent = 'text editor';\r\n\topenInTextEditorLink.href = `command:workbench.action.openLargeOutput?${outputId}`;\r\n\topenInTextEditorLink.ariaLabel = 'open output in text editor';\r\n\tcontainer.appendChild(openInTextEditorLink);\r\n\r\n\tconst third = document.createElement('span');\r\n\tthird.textContent = '. Adjust cell output ';\r\n\tcontainer.appendChild(third);\r\n\r\n\tconst layoutSettingsLink = document.createElement('a');\r\n\tlayoutSettingsLink.textContent = 'settings';\r\n\tlayoutSettingsLink.href = `command:workbench.action.openSettings?%5B%22%40tag%3AnotebookOutputLayout%22%5D`;\r\n\tlayoutSettingsLink.ariaLabel = 'notebook output settings';\r\n\tcontainer.appendChild(layoutSettingsLink);\r\n\r\n\tconst fourth = document.createElement('span');\r\n\tfourth.textContent = '...';\r\n\tcontainer.appendChild(fourth);\r\n\r\n\treturn container;\r\n}\r\n\r\nfunction generateNestedViewAllElement(outputId: string) {\r\n\tconst container = document.createElement('div');\r\n\r\n\tconst link = document.createElement('a');\r\n\tlink.textContent = '...';\r\n\tlink.href = `command:workbench.action.openLargeOutput?${outputId}`;\r\n\tlink.ariaLabel = 'Open full output in text editor';\r\n\tlink.title = 'Open full output in text editor';\r\n\tlink.style.setProperty('text-decoration', 'none');\r\n\tcontainer.appendChild(link);\r\n\r\n\treturn container;\r\n}\r\n\r\nfunction truncatedArrayOfString(id: string, buffer: string[], linesLimit: number, linkOptions: LinkOptions) {\r\n\tconst container = document.createElement('div');\r\n\tcontainer.setAttribute('data-vscode-context', JSON.stringify({\r\n\t\twebviewSection: 'text',\r\n\t\toutputId: id,\r\n\t\t'preventDefaultContextMenuItems': true\r\n\t}));\r\n\tconst lineCount = buffer.length;\r\n\r\n\tif (lineCount <= linesLimit) {\r\n\t\tconst spanElement = handleANSIOutput(buffer.join('\\n'), linkOptions);\r\n\t\tcontainer.appendChild(spanElement);\r\n\t\treturn container;\r\n\t}\r\n\r\n\tcontainer.appendChild(handleANSIOutput(buffer.slice(0, linesLimit - 5).join('\\n'), linkOptions));\r\n\r\n\t// truncated piece\r\n\tconst elipses = document.createElement('div');\r\n\telipses.innerText = '...';\r\n\tcontainer.appendChild(elipses);\r\n\r\n\tcontainer.appendChild(handleANSIOutput(buffer.slice(lineCount - 5).join('\\n'), linkOptions));\r\n\r\n\tcontainer.appendChild(generateViewMoreElement(id));\r\n\r\n\treturn container;\r\n}\r\n\r\nfunction scrollableArrayOfString(id: string, buffer: string[], linkOptions: LinkOptions) {\r\n\tconst element = document.createElement('div');\r\n\telement.setAttribute('data-vscode-context', JSON.stringify({\r\n\t\twebviewSection: 'text',\r\n\t\toutputId: id,\r\n\t\t'preventDefaultContextMenuItems': true\r\n\t}));\r\n\tif (buffer.length > softScrollableLineLimit) {\r\n\t\telement.appendChild(generateNestedViewAllElement(id));\r\n\t}\r\n\r\n\telement.appendChild(handleANSIOutput(buffer.slice(-1 * softScrollableLineLimit).join('\\n'), linkOptions));\r\n\r\n\treturn element;\r\n}\r\n\r\nconst outputLengths: Record<string, number> = {};\r\n\r\nfunction appendScrollableOutput(element: HTMLElement, id: string, appended: string, linkOptions: LinkOptions) {\r\n\tif (!outputLengths[id]) {\r\n\t\toutputLengths[id] = 0;\r\n\t}\r\n\r\n\tconst buffer = appended.split(/\\r\\n|\\r|\\n/g);\r\n\tconst appendedLength = buffer.length + outputLengths[id];\r\n\t// Only append outputs up to the hard limit of lines, then replace it with the last softLimit number of lines\r\n\tif (appendedLength > hardScrollableLineLimit) {\r\n\t\treturn false;\r\n\t}\r\n\telse {\r\n\t\telement.appendChild(handleANSIOutput(buffer.join('\\n'), linkOptions));\r\n\t\toutputLengths[id] = appendedLength;\r\n\t}\r\n\treturn true;\r\n}\r\n\r\nexport function createOutputContent(id: string, outputText: string, options: OutputElementOptions): HTMLElement {\r\n\tconst { linesLimit, error, scrollable, trustHtml, linkifyFilePaths } = options;\r\n\tconst linkOptions: LinkOptions = { linkifyFilePaths, trustHtml };\r\n\tconst buffer = outputText.split(/\\r\\n|\\r|\\n/g);\r\n\toutputLengths[id] = outputLengths[id] = Math.min(buffer.length, softScrollableLineLimit);\r\n\r\n\tlet outputElement: HTMLElement;\r\n\tif (scrollable) {\r\n\t\toutputElement = scrollableArrayOfString(id, buffer, linkOptions);\r\n\t} else {\r\n\t\toutputElement = truncatedArrayOfString(id, buffer, linesLimit, linkOptions);\r\n\t}\r\n\r\n\toutputElement.setAttribute('output-item-id', id);\r\n\tif (error) {\r\n\t\toutputElement.classList.add('error');\r\n\t}\r\n\r\n\treturn outputElement;\r\n}\r\n\r\nexport function appendOutput(outputInfo: OutputWithAppend, existingContent: HTMLElement, options: OutputElementOptions) {\r\n\tconst appendedText = outputInfo.appendedText?.();\r\n\tconst linkOptions = { linkifyFilePaths: options.linkifyFilePaths, trustHtml: options.trustHtml };\r\n\t// appending output only supported for scrollable ouputs currently\r\n\tif (appendedText && options.scrollable) {\r\n\t\tif (appendScrollableOutput(existingContent, outputInfo.id, appendedText, linkOptions)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\r\n\tconst newContent = createOutputContent(outputInfo.id, outputInfo.text(), options);\r\n\texistingContent.replaceWith(newContent);\r\n\twhile (newContent.nextSibling) {\r\n\t\t// clear out any stale content if we had previously combined streaming outputs into this one\r\n\t\tnewContent.nextSibling.remove();\r\n\t}\r\n\r\n}\r\n\r\n"]}