{"version":3,"file":"stackTraceHelper.test.js","sourceRoot":"","sources":["../../src/test/stackTraceHelper.test.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\n\r\nimport { formatStackTrace } from '../stackTraceHelper';\r\nimport * as assert from 'assert';\r\n\r\n// The stack frames for these tests can be retreived by using the raw json for a notebook with an error\r\nsuite('StackTraceHelper', () => {\r\n\r\n\ttest('Non Ipython stack trace is left alone', () => {\r\n\t\tconst stack = 'DivideError: integer division error\\n' +\r\n\t\t\t'Stacktrace:\\n' +\r\n\t\t\t'[1] divide_by_zero(x:: Int64)\\n' +\r\n\t\t\t'@Main c:\\\\src\\\\test\\\\3\\\\otherlanguages\\\\julia.ipynb: 3\\n' +\r\n\t\t\t'[2] top - level scope\\n' +\r\n\t\t\t'@c:\\\\src\\\\test\\\\3\\\\otherlanguages\\\\julia.ipynb: 1; ';\r\n\t\tassert.equal(formatStackTrace(stack, true).formattedStack, stack);\r\n\t});\r\n\r\n\tconst formatSequence = /\\u001b\\[.+?m/g;\r\n\tfunction stripAsciiFormatting(text: string) {\r\n\t\treturn text.replace(formatSequence, '');\r\n\t}\r\n\r\n\ttest('IPython stack line numbers are linkified for IPython 8.3.6', () => {\r\n\t\tconst stack =\r\n\t\t\t'\\u001b[1;31m---------------------------------------------------------------------------\\u001b[0m\\n' +\r\n\t\t\t'\\u001b[1;31mException\\u001b[0m                                 Traceback (most recent call last)\\n' +\r\n\t\t\t'Cell \\u001b[1;32mIn[3], line 2\\u001b[0m\\n' +\r\n\t\t\t'\\u001b[0;32m      1\\u001b[0m \\u001b[38;5;28;01mimport\\u001b[39;00m \\u001b[38;5;21;01mmyLib\\u001b[39;00m\\n' +\r\n\t\t\t'\\u001b[1;32m----> 2\\u001b[0m \\u001b[43mmyLib\\u001b[49m\\u001b[38;5;241;43m.\\u001b[39;49m\\u001b[43mthrowEx\\u001b[49m\\u001b[43m(\\u001b[49m\\u001b[43m)\\u001b[49m\\n' +\r\n\t\t\t'\\n' +\r\n\t\t\t'File \\u001b[1;32mC:\\\\venvs\\\\myLib.py:2\\u001b[0m, in \\u001b[0;36mthrowEx\\u001b[1;34m()\\u001b[0m\\n' +\r\n\t\t\t'\\u001b[0;32m      1\\u001b[0m \\u001b[38;5;28;01mdef\\u001b[39;00m \\u001b[38;5;21mthrowEx\\u001b[39m():\\n' +\r\n\t\t\t'\\u001b[1;32m----> 2\\u001b[0m     \\u001b[38;5;28;01mraise\\u001b[39;00m \\u001b[38;5;167;01mException\\u001b[39;00m\\n\\n' +\r\n\t\t\t'\\u001b[1;31mException\\u001b[0m\\n:';\r\n\r\n\t\tconst { formattedStack, errorLocation } = formatStackTrace(stack, true);\r\n\t\tconst cleanStack = stripAsciiFormatting(formattedStack);\r\n\t\tassert.ok(cleanStack.indexOf('Cell In[3], <a href=\\'vscode-notebook-cell:?execution_count=3&line=2\\'>line 2</a>') > 0, 'Missing line link in ' + cleanStack);\r\n\t\tassert.ok(cleanStack.indexOf('<a href=\\'vscode-notebook-cell:?execution_count=3&line=2\\'>2</a>') > 0, 'Missing frame link in ' + cleanStack);\r\n\t\tassert.ok(cleanStack.indexOf('<a href=\\'C:\\\\venvs\\\\myLib.py:2\\'>2</a>') > 0, 'Missing frame link in ' + cleanStack);\r\n\t\tassert.equal(errorLocation, '<a href=\\'vscode-notebook-cell:?execution_count=3&line=2\\'>line 2</a>');\r\n\t});\r\n\r\n\ttest('IPython stack line numbers are linkified for IPython 9.0.0', () => {\r\n\t\tconst stack =\r\n\t\t\t'\\u001b[31m---------------------------------------------------------------------------\\u001b[39m\\n' +\r\n\t\t\t'\\u001b[31mTypeError\\u001b[39m                                 Traceback (most recent call last)\\n' +\r\n\t\t\t'\\u001b[36mCell\\u001b[39m\\u001b[36m \\u001b[39m\\u001b[32mIn[3]\\u001b[39m\\u001b[32m, line 2\\u001b[39m\\n' +\r\n\t\t\t'\\u001b[32m      1\\u001b[39m x = firstItem((\\u001b[32m1\\u001b[39m, \\u001b[32m2\\u001b[39m, \\u001b[32m3\\u001b[39m, \\u001b[32m5\\u001b[39m))\\n' +\r\n\t\t\t'\\u001b[32m----> \\u001b[39m\\u001b[32m2\\u001b[39m y = \\u001b[43mx\\u001b[49m\\u001b[43m \\u001b[49m\\u001b[43m+\\u001b[49m\\u001b[43m \\u001b[49m\\u001b[32;43m1\\u001b[39;49m\\n' +\r\n\t\t\t'\\u001b[32m      3\\u001b[39m \\u001b[38;5;28mprint\\u001b[39m(y)\\n' +\r\n\t\t\t'\\n' +\r\n\t\t\t'\\u001b[31mTypeError\\u001b[39m: unsupported operand type(s) for +: \"NoneType\" and \"int\"\\n';\r\n\r\n\t\tconst { formattedStack, errorLocation } = formatStackTrace(stack, true);\r\n\t\tconst cleanStack = stripAsciiFormatting(formattedStack);\r\n\t\tassert.ok(cleanStack.indexOf('Cell In[3], <a href=\\'vscode-notebook-cell:?execution_count=3&line=2\\'>line 2</a>') > 0, 'Missing line link in ' + cleanStack);\r\n\t\tassert.ok(cleanStack.indexOf('<a href=\\'vscode-notebook-cell:?execution_count=3&line=2\\'>2</a>') > 0, 'Missing frame link in ' + cleanStack);\r\n\t\tassert.equal(errorLocation, '<a href=\\'vscode-notebook-cell:?execution_count=3&line=2\\'>line 2</a>');\r\n\t});\r\n\r\n\ttest('Does not have catastrophic backtracking https://github.com/microsoft/vscode/issues/251731', () => {\r\n\t\tconst stack =\r\n\t\t\t'\\u001b[31m---------------------------------------------------------------------------\\u001b[39m\\n' +\r\n\t\t\t'\\u001b[31mZeroDivisionError\\u001b[39m                         Traceback (most recent call last)\\n' +\r\n\t\t\t'\\u001b[36mCell\\u001b[39m\\u001b[36m \\u001b[39m\\u001b[32mIn[1]\\u001b[39m\\u001b[32m, line 2\\u001b[39m\\n\\u001b[32m      1\\u001b[39m raw_str = \\u001b[33mr\\u001b[39m\\u001b[33m\\\"\\u001b[39m\\u001b[33m\\\\\\u001b[39m\\u001b[33ma\\u001b[39m\\u001b[33m\\\\\\u001b[39m\\u001b[33mc\\u001b[39m\\u001b[33m\\\\\\u001b[39m\\u001b[33me\\u001b[39m\\u001b[33m\\\\\\u001b[39m\\u001b[33mf\\u001b[39m\\u001b[33m\\\\\\u001b[39m\\u001b[33mg\\u001b[39m\\u001b[33m\\\\\\u001b[39m\\u001b[33mh\\u001b[39m\\u001b[33m\\\\\\u001b[39m\\u001b[33mi\\u001b[39m\\u001b[33m\\\\\\u001b[39m\\u001b[33mk\\u001b[39m\\u001b[33m\\\\\\u001b[39m\\u001b[33ml\\u001b[39m\\u001b[33m\\\\\\u001b[39m\\u001b[33mm\\u001b[39m\\u001b[33m\\\\\\u001b[39m\\u001b[33mn\\u001b[39m\\u001b[33m\\\\\\u001b[39m\\u001b[33mo\\u001b[39m\\u001b[33m\\\"\\u001b[39m\\n\\u001b[32m----> \\u001b[39m\\u001b[32m2\\u001b[39m \\u001b[32;43m1\\u001b[39;49m\\u001b[43m/\\u001b[49m\\u001b[32;43m0\\u001b[39;49m\\n\\n' +\r\n\t\t\t'\\u001b[31mZeroDivisionError\\u001b[39m: division by zero\\n';\r\n\r\n\t\tconst { formattedStack, errorLocation } = formatStackTrace(stack, true);\r\n\t\tconst cleanStack = stripAsciiFormatting(formattedStack);\r\n\t\tassert.ok(cleanStack.indexOf('Cell In[1], <a href=\\'vscode-notebook-cell:?execution_count=1&line=2\\'>line 2</a>') > 0, 'Missing line link in ' + cleanStack);\r\n\t\tassert.ok(cleanStack.indexOf('<a href=\\'vscode-notebook-cell:?execution_count=1&line=2\\'>2</a>') > 0, 'Missing frame link in ' + cleanStack);\r\n\t\tassert.equal(errorLocation, '<a href=\\'vscode-notebook-cell:?execution_count=1&line=2\\'>line 2</a>');\r\n\t});\r\n\r\n\ttest('Stack trace is not linkified when HTML is not trusted', () => {\r\n\t\tconst stack =\r\n\t\t\t'\\u001b[31m---------------------------------------------------------------------------\\u001b[39m\\n' +\r\n\t\t\t'\\u001b[31mTypeError\\u001b[39m                                 Traceback (most recent call last)\\n' +\r\n\t\t\t'\\u001b[36mCell\\u001b[39m\\u001b[36m \\u001b[39m\\u001b[32mIn[3]\\u001b[39m\\u001b[32m, line 2\\u001b[39m\\n' +\r\n\t\t\t'\\u001b[32m      1\\u001b[39m x = firstItem((\\u001b[32m1\\u001b[39m, \\u001b[32m2\\u001b[39m, \\u001b[32m3\\u001b[39m, \\u001b[32m5\\u001b[39m))\\n' +\r\n\t\t\t'\\u001b[32m----> \\u001b[39m\\u001b[32m2\\u001b[39m y = \\u001b[43mx\\u001b[49m\\u001b[43m \\u001b[49m\\u001b[43m+\\u001b[49m\\u001b[43m \\u001b[49m\\u001b[32;43m1\\u001b[39;49m\\n' +\r\n\t\t\t'\\u001b[32m      3\\u001b[39m \\u001b[38;5;28mprint\\u001b[39m(y)\\n' +\r\n\t\t\t'\\n' +\r\n\t\t\t'\\u001b[31mTypeError\\u001b[39m: unsupported operand type(s) for +: \"NoneType\" and \"int\"\\n';\r\n\r\n\t\tconst formattedLines = formatStackTrace(stack, false).formattedStack.split('\\n');\r\n\t\tformattedLines.forEach(line => assert.ok(!/<a href=.*>/.test(line), 'line should not contain a link: ' + line));\r\n\t});\r\n\r\n\ttest('IPython stack line numbers are linkified for IPython 8.3', () => {\r\n\t\t// stack frames within functions do not list the line number, i.e.\r\n\t\t// 'Input In [1], in myfunc()' vs\r\n\t\t// 'Input In [2], in <cell line: 5>()'\r\n\t\tconst stack =\r\n\t\t\t'\\u001b[1;31m---------------------------------------------------------------------------\\u001b[0m\\n' +\r\n\t\t\t'\\u001b[1;31mException\\u001b[0m                                 Traceback (most recent call last)\\n' +\r\n\t\t\t'Input \\u001b[1;32mIn [2]\\u001b[0m, in \\u001b[0;36m<cell line: 5>\\u001b[1;34m()\\u001b[0m\\n' +\r\n\t\t\t'\\u001b[0;32m      3\\u001b[0m \\u001b[38;5;28mprint\\u001b[39m(\\u001b[38;5;124m\\'\\u001b[39m\\u001b[38;5;124mipykernel\\u001b[39m\\u001b[38;5;124m\\'\\u001b[39m, ipykernel\\u001b[38;5;241m.\\u001b[39m__version__)\\n' +\r\n\t\t\t'\\u001b[0;32m      4\\u001b[0m \\u001b[38;5;28mprint\\u001b[39m(\\u001b[38;5;124m\\'\\u001b[39m\\u001b[38;5;124mipython\\u001b[39m\\u001b[38;5;124m\\'\\u001b[39m, IPython\\u001b[38;5;241m.\\u001b[39m__version__)\\n' +\r\n\t\t\t'\\u001b[1;32m----> 5\\u001b[0m \\u001b[43mmyfunc\\u001b[49m\\u001b[43m(\\u001b[49m\\u001b[43m)\\u001b[49m\\n' +\r\n\t\t\t'\\n\\n' +\r\n\t\t\t'Input \\u001b[1;32mIn [1]\\u001b[0m, in \\u001b[0;36mmyfunc\\u001b[1;34m()\\u001b[0m\\n' +\r\n\t\t\t'\\u001b[0;32m      3\\u001b[0m \\u001b[38;5;28;01mdef\\u001b[39;00m \\u001b[38;5;21mmyfunc\\u001b[39m():\\n' +\r\n\t\t\t'\\u001b[1;32m----> 4\\u001b[0m     \\u001b[43mmyLib\\u001b[49m\\u001b[38;5;241;43m.\\u001b[39;49m\\u001b[43mthrowEx\\u001b[49m\\u001b[43m(\\u001b[49m\\u001b[43m)\\u001b[49m\\n' +\r\n\t\t\t'\\n\\n' +\r\n\t\t\t'File \\u001b[1;32mC:\\\\venvs\\\\myLib.py:2\\u001b[0m, in \\u001b[0;36mthrowEx\\u001b[1;34m()\\u001b[0m\\n' +\r\n\t\t\t'\\u001b[0;32m      1\\u001b[0m \\u001b[38;5;28;01mdef\\u001b[39;00m \\u001b[38;5;21mthrowEx\\u001b[39m():\\n' +\r\n\t\t\t'\\u001b[1;32m----> 2\\u001b[0m     \\u001b[38;5;28;01mraise\\u001b[39;00m \\u001b[38;5;167;01mException\\u001b[39;00m\\n' +\r\n\t\t\t'\\n' +\r\n\t\t\t'\\u001b[1;31mException\\u001b[0m:\\n';\r\n\r\n\t\tconst { formattedStack } = formatStackTrace(stack, true);\r\n\t\tconst formatted = stripAsciiFormatting(formattedStack);\r\n\t\tassert.ok(formatted.indexOf('Input <a href=\\'vscode-notebook-cell:?execution_count=2\\'>In [2]</a>, in <cell line: 5>') > 0, 'Missing cell link in ' + formatted);\r\n\t\tassert.ok(formatted.indexOf('Input <a href=\\'vscode-notebook-cell:?execution_count=1\\'>In [1]</a>, in myfunc()') > 0, 'Missing cell link in ' + formatted);\r\n\t\tassert.ok(formatted.indexOf('<a href=\\'vscode-notebook-cell:?execution_count=2&line=5\\'>5</a>') > 0, 'Missing frame link in ' + formatted);\r\n\t});\r\n\r\n\ttest('IPython stack trace lines without associated location are not linkified', () => {\r\n\t\tconst stack =\r\n\t\t\t'\\u001b[1;31m---------------------------------------------------------------------------\\u001b[0m\\n' +\r\n\t\t\t'\\u001b[1;31mException\\u001b[0m                                 Traceback (most recent call last)\\n' +\r\n\t\t\t'Cell \\u001b[1;32mIn[3], line 2\\u001b[0m\\n' +\r\n\t\t\t'\\n' +\r\n\t\t\t'unknown source\\n' +\r\n\t\t\t'\\u001b[0;32m      1\\u001b[0m \\u001b[38;5;28;01mdef\\u001b[39;00m \\u001b[38;5;21mthrowEx\\u001b[39m():\\n' +\r\n\t\t\t'\\u001b[1;32m----> 2\\u001b[0m     \\u001b[38;5;28;01mraise\\u001b[39;00m \\u001b[38;5;167;01mException\\u001b[39;00m\\n\\n' +\r\n\t\t\t'\\u001b[1;31mException\\u001b[0m\\n:';\r\n\r\n\t\tconst formatted = formatStackTrace(stack, true).formattedStack;\r\n\t\tassert.ok(!/<a href=.*>\\d<\\/a>/.test(formatted), formatted);\r\n\t});\r\n\r\n\ttest('IPython stack without line numbers are not linkified', () => {\r\n\t\tconst stack =\r\n\t\t\t'\\u001b[1;36m  Cell \\u001b[1;32mIn[6], line 1\\u001b[1;36m\\u001b[0m\\n' +\r\n\t\t\t'\\u001b[1;33m    print(\\u001b[0m\\n' +\r\n\t\t\t'\\u001b[1;37m          ^\\u001b[0m\\n' +\r\n\t\t\t'\\u001b[1;31mSyntaxError\\u001b[0m\\u001b[1;31m:\\u001b[0m incomplete input\\n' +\r\n\t\t\t// contrived examples to check for more false positives\r\n\t\t\t'1  print(\\n' +\r\n\t\t\t'a 1  print(\\n' +\r\n\t\t\t'   1a  print(\\n';\r\n\r\n\t\tconst formattedLines = formatStackTrace(stack, true).formattedStack.split('\\n');\r\n\t\tassert.ok(/<a href='vscode-notebook-cell.*>/.test(formattedLines[0]), 'line should contain a link: ' + formattedLines[0]);\r\n\t\tformattedLines.slice(1).forEach(line => assert.ok(!/<a href=.*>/.test(line), 'line should not contain a link: ' + line));\r\n\t});\r\n\r\n\ttest('background (40-49) ANSI colors are removed', () => {\r\n\t\tconst stack =\r\n\t\t\t'open\\u001b[39;49m\\u001b[43m(\\u001b[49m\\u001b[33;43m\\'\\u001b[39;49m\\u001b[33;43minput.txt\\u001b[39;49m\\u001b[33;43m\\'\\u001b[39;49m\\u001b[43m)\\u001b[49m;';\r\n\r\n\t\tconst formattedLines = formatStackTrace(stack, true).formattedStack.split('\\n');\r\n\t\tassert.ok(!/4\\d/.test(formattedLines[0]), 'should not contain background colors ' + formattedLines[0]);\r\n\t\tformattedLines.slice(1).forEach(line => assert.ok(!/<a href=.*>/.test(line), 'line should not contain a link: ' + line));\r\n\t});\r\n\r\n});\r\n"]}