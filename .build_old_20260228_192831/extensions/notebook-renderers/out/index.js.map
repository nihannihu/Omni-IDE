{"version":3,"file":"index.js","sourceRoot":"","sources":["../src/index.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\n\r\nimport type { ActivationFunction, OutputItem, RendererContext } from 'vscode-notebook-renderer';\r\nimport { createOutputContent, appendOutput, scrollableClass } from './textHelper';\r\nimport { HtmlRenderingHook, IDisposable, IRichRenderContext, JavaScriptRenderingHook, OutputWithAppend, RenderOptions } from './rendererTypes';\r\nimport { ttPolicy } from './htmlHelper';\r\nimport { formatStackTrace } from './stackTraceHelper';\r\n\r\nfunction clearContainer(container: HTMLElement) {\r\n\twhile (container.firstChild) {\r\n\t\tcontainer.firstChild.remove();\r\n\t}\r\n}\r\n\r\nfunction renderImage(outputInfo: OutputItem, element: HTMLElement): IDisposable {\r\n\tconst blob = new Blob([outputInfo.data() as Uint8Array<ArrayBuffer>], { type: outputInfo.mime });\r\n\tconst src = URL.createObjectURL(blob);\r\n\tconst disposable = {\r\n\t\tdispose: () => {\r\n\t\t\tURL.revokeObjectURL(src);\r\n\t\t}\r\n\t};\r\n\r\n\tif (element.firstChild) {\r\n\t\tconst display = element.firstChild as HTMLElement;\r\n\t\tif (display.firstChild && display.firstChild.nodeName === 'IMG' && display.firstChild instanceof HTMLImageElement) {\r\n\t\t\tdisplay.firstChild.src = src;\r\n\t\t\treturn disposable;\r\n\t\t}\r\n\t}\r\n\r\n\tconst image = document.createElement('img');\r\n\timage.src = src;\r\n\tconst alt = getAltText(outputInfo);\r\n\tif (alt) {\r\n\t\timage.alt = alt;\r\n\t}\r\n\timage.setAttribute('data-vscode-context', JSON.stringify({\r\n\t\twebviewSection: 'image',\r\n\t\toutputId: outputInfo.id,\r\n\t\t'preventDefaultContextMenuItems': true\r\n\t}));\r\n\tconst display = document.createElement('div');\r\n\tdisplay.classList.add('display');\r\n\tdisplay.appendChild(image);\r\n\telement.appendChild(display);\r\n\r\n\treturn disposable;\r\n}\r\n\r\nconst preservedScriptAttributes: (keyof HTMLScriptElement)[] = [\r\n\t'type', 'src', 'nonce', 'noModule', 'async',\r\n];\r\n\r\nconst domEval = (container: Element) => {\r\n\tconst arr = Array.from(container.getElementsByTagName('script'));\r\n\tfor (let n = 0; n < arr.length; n++) {\r\n\t\tconst node = arr[n];\r\n\t\tconst scriptTag = document.createElement('script');\r\n\t\tconst trustedScript = ttPolicy?.createScript(node.innerText) ?? node.innerText;\r\n\t\tscriptTag.text = trustedScript as string;\r\n\t\tfor (const key of preservedScriptAttributes) {\r\n\t\t\tconst val = node[key] || node.getAttribute && node.getAttribute(key);\r\n\t\t\tif (val) {\r\n\t\t\t\tscriptTag.setAttribute(key, val as unknown as string);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// TODO@connor4312: should script with src not be removed?\r\n\t\tcontainer.appendChild(scriptTag).parentNode!.removeChild(scriptTag);\r\n\t}\r\n};\r\n\r\nfunction getAltText(outputInfo: OutputItem) {\r\n\tconst metadata = outputInfo.metadata as Record<string, unknown> | undefined;\r\n\tif (typeof metadata === 'object' && metadata && typeof metadata.vscode_altText === 'string') {\r\n\t\treturn metadata.vscode_altText;\r\n\t}\r\n\treturn undefined;\r\n}\r\n\r\nfunction fixUpSvgElement(outputInfo: OutputItem, element: HTMLElement) {\r\n\tif (outputInfo.mime.indexOf('svg') > -1) {\r\n\t\tconst svgElement = element.querySelector('svg');\r\n\t\tconst altText = getAltText(outputInfo);\r\n\t\tif (svgElement && altText) {\r\n\t\t\tconst title = document.createElement('title');\r\n\t\t\ttitle.innerText = altText;\r\n\t\t\tsvgElement.prepend(title);\r\n\t\t}\r\n\r\n\t\tif (svgElement) {\r\n\t\t\tsvgElement.classList.add('output-image');\r\n\r\n\t\t\tsvgElement.setAttribute('data-vscode-context', JSON.stringify({\r\n\t\t\t\twebviewSection: 'image',\r\n\t\t\t\toutputId: outputInfo.id,\r\n\t\t\t\t'preventDefaultContextMenuItems': true\r\n\t\t\t}));\r\n\t\t}\r\n\t}\r\n}\r\n\r\nasync function renderHTML(outputInfo: OutputItem, container: HTMLElement, signal: AbortSignal, hooks: Iterable<HtmlRenderingHook>): Promise<void> {\r\n\tclearContainer(container);\r\n\tlet element: HTMLElement = document.createElement('div');\r\n\tconst htmlContent = outputInfo.text();\r\n\tconst trustedHtml = ttPolicy?.createHTML(htmlContent) ?? htmlContent;\r\n\telement.innerHTML = trustedHtml as string;\r\n\tfixUpSvgElement(outputInfo, element);\r\n\r\n\tfor (const hook of hooks) {\r\n\t\telement = (await hook.postRender(outputInfo, element, signal)) ?? element;\r\n\t\tif (signal.aborted) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\r\n\tcontainer.appendChild(element);\r\n\tdomEval(element);\r\n}\r\n\r\nasync function renderJavascript(outputInfo: OutputItem, container: HTMLElement, signal: AbortSignal, hooks: Iterable<JavaScriptRenderingHook>): Promise<void> {\r\n\tlet scriptText = outputInfo.text();\r\n\r\n\tfor (const hook of hooks) {\r\n\t\tscriptText = (await hook.preEvaluate(outputInfo, container, scriptText, signal)) ?? scriptText;\r\n\t\tif (signal.aborted) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\r\n\tconst script = document.createElement('script');\r\n\tscript.type = 'module';\r\n\tscript.textContent = scriptText;\r\n\r\n\tconst element = document.createElement('div');\r\n\tconst trustedHtml = ttPolicy?.createHTML(script.outerHTML) ?? script.outerHTML;\r\n\telement.innerHTML = trustedHtml as string;\r\n\tcontainer.appendChild(element);\r\n\tdomEval(element);\r\n}\r\n\r\ninterface Event<T> {\r\n\t(listener: (e: T) => any, thisArgs?: any, disposables?: IDisposable[]): IDisposable;\r\n}\r\n\r\nfunction createDisposableStore(): { push(...disposables: IDisposable[]): void; dispose(): void } {\r\n\tconst localDisposables: IDisposable[] = [];\r\n\tconst disposable = {\r\n\t\tpush: (...disposables: IDisposable[]) => {\r\n\t\t\tlocalDisposables.push(...disposables);\r\n\t\t},\r\n\t\tdispose: () => {\r\n\t\t\tlocalDisposables.forEach(d => d.dispose());\r\n\t\t}\r\n\t};\r\n\r\n\treturn disposable;\r\n}\r\n\r\ntype DisposableStore = ReturnType<typeof createDisposableStore>;\r\n\r\nfunction renderError(\r\n\toutputInfo: OutputItem,\r\n\toutputElement: HTMLElement,\r\n\tctx: IRichRenderContext,\r\n\ttrustHtml: boolean\r\n): IDisposable {\r\n\tconst disposableStore = createDisposableStore();\r\n\r\n\tclearContainer(outputElement);\r\n\r\n\ttype ErrorLike = Partial<Error>;\r\n\r\n\tlet err: ErrorLike;\r\n\ttry {\r\n\t\terr = <ErrorLike>JSON.parse(outputInfo.text());\r\n\t} catch (e) {\r\n\t\tconsole.log(e);\r\n\t\treturn disposableStore;\r\n\t}\r\n\r\n\tconst headerMessage = err.name && err.message ? `${err.name}: ${err.message}` : err.name || err.message;\r\n\r\n\tif (err.stack) {\r\n\t\tconst minimalError = ctx.settings.minimalError && !!headerMessage?.length;\r\n\t\toutputElement.classList.add('traceback');\r\n\r\n\t\tconst { formattedStack, errorLocation } = formatStackTrace(err.stack, trustHtml);\r\n\r\n\t\tconst outputScrolling = !minimalError && scrollingEnabled(outputInfo, ctx.settings);\r\n\t\tconst lineLimit = minimalError ? 1000 : ctx.settings.lineLimit;\r\n\t\tconst outputOptions = { linesLimit: lineLimit, scrollable: outputScrolling, trustHtml, linkifyFilePaths: false };\r\n\r\n\t\tconst content = createOutputContent(outputInfo.id, formattedStack, outputOptions);\r\n\t\tconst stackTraceElement = document.createElement('div');\r\n\t\tstackTraceElement.appendChild(content);\r\n\t\toutputElement.classList.toggle('word-wrap', ctx.settings.outputWordWrap);\r\n\t\tdisposableStore.push(ctx.onDidChangeSettings(e => {\r\n\t\t\toutputElement.classList.toggle('word-wrap', e.outputWordWrap);\r\n\t\t}));\r\n\r\n\t\tif (minimalError) {\r\n\t\t\tcreateMinimalError(errorLocation, headerMessage, stackTraceElement, outputElement);\r\n\t\t} else {\r\n\t\t\tstackTraceElement.classList.toggle('scrollable', outputScrolling);\r\n\t\t\toutputElement.appendChild(stackTraceElement);\r\n\t\t\tinitializeScroll(stackTraceElement, disposableStore);\r\n\t\t}\r\n\t} else {\r\n\t\tconst header = document.createElement('div');\r\n\t\tif (headerMessage) {\r\n\t\t\theader.innerText = headerMessage;\r\n\t\t\toutputElement.appendChild(header);\r\n\t\t}\r\n\t}\r\n\r\n\toutputElement.classList.add('error');\r\n\treturn disposableStore;\r\n}\r\n\r\nfunction createMinimalError(errorLocation: string | undefined, headerMessage: string, stackTrace: HTMLDivElement, outputElement: HTMLElement) {\r\n\tconst outputDiv = document.createElement('div');\r\n\tconst headerSection = document.createElement('div');\r\n\theaderSection.classList.add('error-output-header');\r\n\r\n\tif (errorLocation && errorLocation.indexOf('<a') === 0) {\r\n\t\theaderSection.innerHTML = errorLocation;\r\n\t}\r\n\tconst header = document.createElement('span');\r\n\theader.innerText = headerMessage;\r\n\theaderSection.appendChild(header);\r\n\toutputDiv.appendChild(headerSection);\r\n\r\n\tfunction addButton(linkElement: HTMLElement) {\r\n\t\tconst button = document.createElement('li');\r\n\t\tbutton.appendChild(linkElement);\r\n\t\t// the :hover css selector doesn't work in the webview,\r\n\t\t// so we need to add the hover class manually\r\n\t\tbutton.onmouseover = function () {\r\n\t\t\tbutton.classList.add('hover');\r\n\t\t};\r\n\t\tbutton.onmouseout = function () {\r\n\t\t\tbutton.classList.remove('hover');\r\n\t\t};\r\n\t\treturn button;\r\n\t}\r\n\r\n\tconst buttons = document.createElement('ul');\r\n\tbuttons.classList.add('error-output-actions');\r\n\toutputDiv.appendChild(buttons);\r\n\r\n\tconst toggleStackLink = document.createElement('a');\r\n\ttoggleStackLink.innerText = 'Show Details';\r\n\ttoggleStackLink.href = '#!';\r\n\tbuttons.appendChild(addButton(toggleStackLink));\r\n\r\n\ttoggleStackLink.onclick = (e) => {\r\n\t\te.preventDefault();\r\n\t\tconst hidden = stackTrace.style.display === 'none';\r\n\t\tstackTrace.style.display = hidden ? '' : 'none';\r\n\t\ttoggleStackLink.innerText = hidden ? 'Hide Details' : 'Show Details';\r\n\t};\r\n\r\n\toutputDiv.appendChild(stackTrace);\r\n\tstackTrace.style.display = 'none';\r\n\toutputElement.appendChild(outputDiv);\r\n}\r\n\r\nfunction getPreviousMatchingContentGroup(outputElement: HTMLElement) {\r\n\tconst outputContainer = outputElement.parentElement;\r\n\tlet match: HTMLElement | undefined = undefined;\r\n\r\n\tlet previous = outputContainer?.previousSibling;\r\n\twhile (previous) {\r\n\t\tconst outputElement = (previous.firstChild as HTMLElement | null);\r\n\t\tif (!outputElement || !outputElement.classList.contains('output-stream')) {\r\n\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tmatch = outputElement.firstChild as HTMLElement;\r\n\t\tprevious = previous?.previousSibling;\r\n\t}\r\n\r\n\treturn match;\r\n}\r\n\r\nfunction onScrollHandler(e: globalThis.Event) {\r\n\tconst target = e.target as HTMLElement;\r\n\tif (target.scrollTop === 0) {\r\n\t\ttarget.classList.remove('more-above');\r\n\t} else {\r\n\t\ttarget.classList.add('more-above');\r\n\t}\r\n}\r\n\r\nfunction onKeypressHandler(e: KeyboardEvent) {\r\n\tif (e.ctrlKey || e.shiftKey) {\r\n\t\treturn;\r\n\t}\r\n\tif (e.code === 'ArrowDown' || e.code === 'ArrowUp' ||\r\n\t\te.code === 'End' || e.code === 'Home' ||\r\n\t\te.code === 'PageUp' || e.code === 'PageDown') {\r\n\t\t// These should change the scroll position, not adjust the selected cell in the notebook\r\n\t\te.stopPropagation();\r\n\t}\r\n}\r\n\r\n// if there is a scrollable output, it will be scrolled to the given value if provided or the bottom of the element\r\nfunction initializeScroll(scrollableElement: HTMLElement, disposables: DisposableStore, scrollTop?: number) {\r\n\tif (scrollableElement.classList.contains(scrollableClass)) {\r\n\t\tconst scrollbarVisible = scrollableElement.scrollHeight > scrollableElement.clientHeight;\r\n\t\tscrollableElement.classList.toggle('scrollbar-visible', scrollbarVisible);\r\n\t\tscrollableElement.scrollTop = scrollTop !== undefined ? scrollTop : scrollableElement.scrollHeight;\r\n\t\tif (scrollbarVisible) {\r\n\t\t\tscrollableElement.addEventListener('scroll', onScrollHandler);\r\n\t\t\tdisposables.push({ dispose: () => scrollableElement.removeEventListener('scroll', onScrollHandler) });\r\n\t\t\tscrollableElement.addEventListener('keydown', onKeypressHandler);\r\n\t\t\tdisposables.push({ dispose: () => scrollableElement.removeEventListener('keydown', onKeypressHandler) });\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// Find the scrollTop of the existing scrollable output, return undefined if at the bottom or element doesn't exist\r\nfunction findScrolledHeight(container: HTMLElement): number | undefined {\r\n\tconst scrollableElement = container.querySelector('.' + scrollableClass);\r\n\tif (scrollableElement && scrollableElement.scrollHeight - scrollableElement.scrollTop - scrollableElement.clientHeight > 2) {\r\n\t\t// not scrolled to the bottom\r\n\t\treturn scrollableElement.scrollTop;\r\n\t}\r\n\treturn undefined;\r\n}\r\n\r\nfunction scrollingEnabled(output: OutputItem, options: RenderOptions) {\r\n\tconst metadata = output.metadata as Record<string, unknown> | undefined;\r\n\treturn (typeof metadata === 'object' && metadata\r\n\t\t&& typeof metadata.scrollable === 'boolean') ?\r\n\t\tmetadata.scrollable : options.outputScrolling;\r\n}\r\n\r\n//  div.cell_container\r\n//    div.output_container\r\n//      div.output.output-stream\t\t<-- outputElement parameter\r\n//        div.scrollable? tabindex=\"0\" \t<-- contentParent\r\n//          div output-item-id=\"{guid}\"\t<-- content from outputItem parameter\r\nfunction renderStream(outputInfo: OutputWithAppend, outputElement: HTMLElement, error: boolean, ctx: IRichRenderContext): IDisposable {\r\n\tconst disposableStore = createDisposableStore();\r\n\tconst outputScrolling = scrollingEnabled(outputInfo, ctx.settings);\r\n\tconst outputOptions = { linesLimit: ctx.settings.lineLimit, scrollable: outputScrolling, trustHtml: false, error, linkifyFilePaths: ctx.settings.linkifyFilePaths };\r\n\r\n\toutputElement.classList.add('output-stream');\r\n\r\n\tconst scrollTop = outputScrolling ? findScrolledHeight(outputElement) : undefined;\r\n\r\n\tconst previousOutputParent = getPreviousMatchingContentGroup(outputElement);\r\n\t// If the previous output item for the same cell was also a stream, append this output to the previous\r\n\tif (previousOutputParent) {\r\n\t\tconst existingContent = previousOutputParent.querySelector(`[output-item-id=\"${outputInfo.id}\"]`) as HTMLElement | null;\r\n\t\tif (existingContent) {\r\n\t\t\tappendOutput(outputInfo, existingContent, outputOptions);\r\n\t\t} else {\r\n\t\t\tconst newContent = createOutputContent(outputInfo.id, outputInfo.text(), outputOptions);\r\n\t\t\tpreviousOutputParent.appendChild(newContent);\r\n\t\t}\r\n\t\tpreviousOutputParent.classList.toggle('scrollbar-visible', previousOutputParent.scrollHeight > previousOutputParent.clientHeight);\r\n\t\tpreviousOutputParent.scrollTop = scrollTop !== undefined ? scrollTop : previousOutputParent.scrollHeight;\r\n\t} else {\r\n\t\tconst existingContent = outputElement.querySelector(`[output-item-id=\"${outputInfo.id}\"]`) as HTMLElement | null;\r\n\t\tlet contentParent = existingContent?.parentElement;\r\n\t\tif (existingContent && contentParent) {\r\n\t\t\tappendOutput(outputInfo, existingContent, outputOptions);\r\n\t\t} else {\r\n\t\t\tconst newContent = createOutputContent(outputInfo.id, outputInfo.text(), outputOptions);\r\n\t\t\tcontentParent = document.createElement('div');\r\n\t\t\tcontentParent.appendChild(newContent);\r\n\t\t\twhile (outputElement.firstChild) {\r\n\t\t\t\toutputElement.firstChild.remove();\r\n\t\t\t}\r\n\t\t\toutputElement.appendChild(contentParent);\r\n\t\t}\r\n\r\n\t\tcontentParent.classList.toggle('scrollable', outputScrolling);\r\n\t\toutputElement.classList.toggle('word-wrap', ctx.settings.outputWordWrap);\r\n\t\tdisposableStore.push(ctx.onDidChangeSettings(e => {\r\n\t\t\toutputElement.classList.toggle('word-wrap', e.outputWordWrap);\r\n\t\t}));\r\n\r\n\t\tinitializeScroll(contentParent, disposableStore, scrollTop);\r\n\t}\r\n\r\n\treturn disposableStore;\r\n}\r\n\r\nfunction renderText(outputInfo: OutputItem, outputElement: HTMLElement, ctx: IRichRenderContext): IDisposable {\r\n\tconst disposableStore = createDisposableStore();\r\n\tclearContainer(outputElement);\r\n\r\n\tconst text = outputInfo.text();\r\n\tconst outputScrolling = scrollingEnabled(outputInfo, ctx.settings);\r\n\tconst outputOptions = { linesLimit: ctx.settings.lineLimit, scrollable: outputScrolling, trustHtml: false, linkifyFilePaths: ctx.settings.linkifyFilePaths };\r\n\tconst content = createOutputContent(outputInfo.id, text, outputOptions);\r\n\tcontent.classList.add('output-plaintext');\r\n\tcontent.classList.toggle('word-wrap', ctx.settings.outputWordWrap);\r\n\tdisposableStore.push(ctx.onDidChangeSettings(e => {\r\n\t\tcontent.classList.toggle('word-wrap', e.outputWordWrap);\r\n\t}));\r\n\r\n\tcontent.classList.toggle('scrollable', outputScrolling);\r\n\toutputElement.appendChild(content);\r\n\tinitializeScroll(content, disposableStore);\r\n\r\n\treturn disposableStore;\r\n}\r\n\r\nexport const activate: ActivationFunction<void> = (ctx) => {\r\n\tconst disposables = new Map<string, IDisposable>();\r\n\tconst htmlHooks = new Set<HtmlRenderingHook>();\r\n\tconst jsHooks = new Set<JavaScriptRenderingHook>();\r\n\r\n\tconst latestContext = ctx as (RendererContext<void> & { readonly settings: RenderOptions; readonly onDidChangeSettings: Event<RenderOptions> });\r\n\r\n\tconst style = document.createElement('style');\r\n\tstyle.textContent = `\r\n\t#container div.output.remove-padding {\r\n\t\tpadding-left: 0;\r\n\t\tpadding-right: 0;\r\n\t}\r\n\t.output-plaintext,\r\n\t.output-stream,\r\n\t.traceback {\r\n\t\tdisplay: inline-block;\r\n\t\twidth: 100%;\r\n\t\tline-height: var(--notebook-cell-output-line-height);\r\n\t\tfont-family: var(--notebook-cell-output-font-family);\r\n\t\tfont-size: var(--notebook-cell-output-font-size);\r\n\t\tuser-select: text;\r\n\t\t-webkit-user-select: text;\r\n\t\t-ms-user-select: text;\r\n\t\tcursor: auto;\r\n\t\tword-wrap: break-word;\r\n\t\t/* text/stream output container should scroll but preserve newline character */\r\n\t\twhite-space: pre;\r\n\t}\r\n\t/* When wordwrap turned on, force it to pre-wrap */\r\n\t#container div.output_container .word-wrap {\r\n\t\twhite-space: pre-wrap;\r\n\t}\r\n\t#container div.output>div {\r\n\t\tpadding-left: var(--notebook-output-node-left-padding);\r\n\t\tpadding-right: var(--notebook-output-node-padding);\r\n\t\tbox-sizing: border-box;\r\n\t\tborder-width: 1px;\r\n\t\tborder-style: solid;\r\n\t\tborder-color: transparent;\r\n\t}\r\n\t#container div.output>div:focus {\r\n\t\toutline: 0;\r\n\t\tborder-color: var(--theme-input-focus-border-color);\r\n\t}\r\n\t#container div.output .scrollable {\r\n\t\toverflow-y: auto;\r\n\t\tmax-height: var(--notebook-cell-output-max-height);\r\n\t}\r\n\t#container div.output .scrollable.scrollbar-visible {\r\n\t\tborder-color: var(--vscode-editorWidget-border);\r\n\t}\r\n\t#container div.output .scrollable.scrollbar-visible:focus {\r\n\t\tborder-color: var(--theme-input-focus-border-color);\r\n\t}\r\n\t#container div.truncation-message {\r\n\t\tfont-style: italic;\r\n\t\tfont-family: var(--theme-font-family);\r\n\t\tpadding-top: 4px;\r\n\t}\r\n\t#container div.output .scrollable div {\r\n\t\tcursor: text;\r\n\t}\r\n\t#container div.output .scrollable div a {\r\n\t\tcursor: pointer;\r\n\t}\r\n\t#container div.output .scrollable.more-above {\r\n\t\tbox-shadow: var(--vscode-scrollbar-shadow) 0 6px 6px -6px inset\r\n\t}\r\n\t.output-plaintext .code-bold,\r\n\t.output-stream .code-bold,\r\n\t.traceback .code-bold {\r\n\t\tfont-weight: bold;\r\n\t}\r\n\t.output-plaintext .code-italic,\r\n\t.output-stream .code-italic,\r\n\t.traceback .code-italic {\r\n\t\tfont-style: italic;\r\n\t}\r\n\t.output-plaintext .code-strike-through,\r\n\t.output-stream .code-strike-through,\r\n\t.traceback .code-strike-through {\r\n\t\ttext-decoration: line-through;\r\n\t}\r\n\t.output-plaintext .code-underline,\r\n\t.output-stream .code-underline,\r\n\t.traceback .code-underline {\r\n\t\ttext-decoration: underline;\r\n\t}\r\n\t#container ul.error-output-actions {\r\n\t\tmargin: 0px;\r\n\t\tpadding: 6px 0px 0px 6px;\r\n\t\tpadding-inline-start: 0px;\r\n\t}\r\n\t#container .error-output-actions li {\r\n\t\tpadding: 0px 4px 0px 4px;\r\n\t\tborder-radius: 5px;\r\n\t\theight: 20px;\r\n\t\tdisplay: inline-flex;\r\n\t\tcursor: pointer;\r\n\t\tborder: solid 1px var(--vscode-notebook-cellToolbarSeparator);\r\n\t}\r\n\t#container .error-output-actions li.hover {\r\n\t\tbackground-color: var(--vscode-toolbar-hoverBackground);\r\n\t}\r\n\t#container .error-output-actions li:focus-within {\r\n\t\tborder-color: var(--theme-input-focus-border-color);\r\n\t}\r\n\t#container .error-output-actions a:focus {\r\n\t\toutline: 0;\r\n\t}\r\n\t#container .error-output-actions li a {\r\n\t\tcolor: var(--vscode-foreground);\r\n\t\ttext-decoration: none;\r\n\t}\r\n\t#container .error-output-header a {\r\n\t\tpadding-right: 12px;\r\n\t}\r\n\t`;\r\n\tdocument.body.appendChild(style);\r\n\r\n\treturn {\r\n\t\trenderOutputItem: async (outputInfo, element, signal?: AbortSignal) => {\r\n\t\t\telement.classList.add('remove-padding');\r\n\t\t\tswitch (outputInfo.mime) {\r\n\t\t\t\tcase 'text/html':\r\n\t\t\t\tcase 'image/svg+xml': {\r\n\t\t\t\t\tif (!ctx.workspace.isTrusted) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tawait renderHTML(outputInfo, element, signal!, htmlHooks);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tcase 'application/javascript': {\r\n\t\t\t\t\tif (!ctx.workspace.isTrusted) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\trenderJavascript(outputInfo, element, signal!, jsHooks);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tcase 'image/gif':\r\n\t\t\t\tcase 'image/png':\r\n\t\t\t\tcase 'image/jpeg':\r\n\t\t\t\tcase 'image/git':\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tdisposables.get(outputInfo.id)?.dispose();\r\n\t\t\t\t\t\tconst disposable = renderImage(outputInfo, element);\r\n\t\t\t\t\t\tdisposables.set(outputInfo.id, disposable);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'application/vnd.code.notebook.error':\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tdisposables.get(outputInfo.id)?.dispose();\r\n\t\t\t\t\t\tconst disposable = renderError(outputInfo, element, latestContext, ctx.workspace.isTrusted);\r\n\t\t\t\t\t\tdisposables.set(outputInfo.id, disposable);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'application/vnd.code.notebook.stdout':\r\n\t\t\t\tcase 'application/x.notebook.stdout':\r\n\t\t\t\tcase 'application/x.notebook.stream':\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tdisposables.get(outputInfo.id)?.dispose();\r\n\t\t\t\t\t\tconst disposable = renderStream(outputInfo, element, false, latestContext);\r\n\t\t\t\t\t\tdisposables.set(outputInfo.id, disposable);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'application/vnd.code.notebook.stderr':\r\n\t\t\t\tcase 'application/x.notebook.stderr':\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tdisposables.get(outputInfo.id)?.dispose();\r\n\t\t\t\t\t\tconst disposable = renderStream(outputInfo, element, true, latestContext);\r\n\t\t\t\t\t\tdisposables.set(outputInfo.id, disposable);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'text/plain':\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tdisposables.get(outputInfo.id)?.dispose();\r\n\t\t\t\t\t\tconst disposable = renderText(outputInfo, element, latestContext);\r\n\t\t\t\t\t\tdisposables.set(outputInfo.id, disposable);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tif (outputInfo.mime.indexOf('text/') > -1) {\r\n\t\t\t\t\t\tdisposables.get(outputInfo.id)?.dispose();\r\n\t\t\t\t\t\tconst disposable = renderText(outputInfo, element, latestContext);\r\n\t\t\t\t\t\tdisposables.set(outputInfo.id, disposable);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tif (element.querySelector('div')) {\r\n\t\t\t\telement.querySelector('div')!.tabIndex = 0;\r\n\t\t\t}\r\n\r\n\t\t},\r\n\t\tdisposeOutputItem: (id: string | undefined) => {\r\n\t\t\tif (id) {\r\n\t\t\t\tdisposables.get(id)?.dispose();\r\n\t\t\t} else {\r\n\t\t\t\tdisposables.forEach(d => d.dispose());\r\n\t\t\t}\r\n\t\t},\r\n\t\texperimental_registerHtmlRenderingHook: (hook: HtmlRenderingHook): IDisposable => {\r\n\t\t\thtmlHooks.add(hook);\r\n\t\t\treturn {\r\n\t\t\t\tdispose: () => {\r\n\t\t\t\t\thtmlHooks.delete(hook);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t},\r\n\t\texperimental_registerJavaScriptRenderingHook: (hook: JavaScriptRenderingHook): IDisposable => {\r\n\t\t\tjsHooks.add(hook);\r\n\t\t\treturn {\r\n\t\t\t\tdispose: () => {\r\n\t\t\t\t\tjsHooks.delete(hook);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\t};\r\n};\r\n"]}