{"version":3,"file":"editorManager.js","sourceRoot":"","sources":["../src/editorManager.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport * as vscode from 'vscode';\r\nimport { generateUuid } from './util/uuid';\r\nimport { MermaidWebviewManager } from './webviewManager';\r\nimport { escapeHtmlText } from './util/html';\r\nimport { Disposable } from './util/dispose';\r\n\r\nexport const mermaidEditorViewType = 'vscode.chat-mermaid-features.preview';\r\n\r\ninterface MermaidPreviewState {\r\n\treadonly webviewId: string;\r\n\treadonly mermaidSource: string;\r\n}\r\n\r\n/**\r\n * Manages mermaid diagram editor panels, ensuring only one editor per diagram.\r\n */\r\nexport class MermaidEditorManager extends Disposable implements vscode.WebviewPanelSerializer {\r\n\r\n\tprivate readonly _previews = new Map<string, MermaidPreview>();\r\n\r\n\tconstructor(\r\n\t\tprivate readonly _extensionUri: vscode.Uri,\r\n\t\tprivate readonly _webviewManager: MermaidWebviewManager\r\n\t) {\r\n\t\tsuper();\r\n\r\n\t\tthis._register(vscode.window.registerWebviewPanelSerializer(mermaidEditorViewType, this));\r\n\t}\r\n\r\n\t/**\r\n\t * Opens a preview for the given diagram\r\n\t *\r\n\t * If a preview already exists for this diagram, it will be revealed instead of creating a new one.\r\n\t */\r\n\tpublic openPreview(mermaidSource: string, title?: string): void {\r\n\t\tconst webviewId = getWebviewId(mermaidSource);\r\n\t\tconst existingPreview = this._previews.get(webviewId);\r\n\t\tif (existingPreview) {\r\n\t\t\texistingPreview.reveal();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst preview = MermaidPreview.create(\r\n\t\t\twebviewId,\r\n\t\t\tmermaidSource,\r\n\t\t\ttitle,\r\n\t\t\tthis._extensionUri,\r\n\t\t\tthis._webviewManager,\r\n\t\t\tvscode.ViewColumn.Active);\r\n\r\n\t\tthis._registerPreview(preview);\r\n\t}\r\n\r\n\tpublic async deserializeWebviewPanel(\r\n\t\twebviewPanel: vscode.WebviewPanel,\r\n\t\tstate: MermaidPreviewState\r\n\t): Promise<void> {\r\n\t\tif (!state?.mermaidSource) {\r\n\t\t\twebviewPanel.webview.html = this._getErrorHtml();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst webviewId = getWebviewId(state.mermaidSource);\r\n\r\n\t\tconst preview = MermaidPreview.revive(\r\n\t\t\twebviewPanel,\r\n\t\t\twebviewId,\r\n\t\t\tstate.mermaidSource,\r\n\t\t\tthis._extensionUri,\r\n\t\t\tthis._webviewManager\r\n\t\t);\r\n\r\n\t\tthis._registerPreview(preview);\r\n\t}\r\n\r\n\tprivate _registerPreview(preview: MermaidPreview): void {\r\n\t\tthis._previews.set(preview.diagramId, preview);\r\n\r\n\t\tpreview.onDispose(() => {\r\n\t\t\tthis._previews.delete(preview.diagramId);\r\n\t\t});\r\n\t}\r\n\r\n\tprivate _getErrorHtml(): string {\r\n\t\treturn /* html */`<!DOCTYPE html>\r\n\t\t\t<html lang=\"en\">\r\n\t\t\t<head>\r\n\t\t\t\t<meta charset=\"UTF-8\">\r\n\t\t\t\t<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n\t\t\t\t<title>Mermaid Preview</title>\r\n\t\t\t\t<meta http-equiv=\"Content-Security-Policy\" content=\"default-src 'none';\">\r\n\t\t\t\t<style>\r\n\t\t\t\t\tbody {\r\n\t\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\t\tjustify-content: center;\r\n\t\t\t\t\t\talign-items: center;\r\n\t\t\t\t\t\theight: 100vh;\r\n\t\t\t\t\t\tmargin: 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t</style>\r\n\t\t\t</head>\r\n\t\t\t<body>\r\n\t\t\t\t<p>An unexpected error occurred while restoring the Mermaid preview.</p>\r\n\t\t\t</body>\r\n\t\t\t</html>`;\r\n\t}\r\n\r\n\tpublic override dispose(): void {\r\n\t\tsuper.dispose();\r\n\r\n\t\tfor (const preview of this._previews.values()) {\r\n\t\t\tpreview.dispose();\r\n\t\t}\r\n\t\tthis._previews.clear();\r\n\t}\r\n}\r\n\r\nclass MermaidPreview extends Disposable {\r\n\r\n\tprivate readonly _onDisposeEmitter = this._register(new vscode.EventEmitter<void>());\r\n\tpublic readonly onDispose = this._onDisposeEmitter.event;\r\n\r\n\tpublic static create(\r\n\t\tdiagramId: string,\r\n\t\tmermaidSource: string,\r\n\t\ttitle: string | undefined,\r\n\t\textensionUri: vscode.Uri,\r\n\t\twebviewManager: MermaidWebviewManager,\r\n\t\tviewColumn: vscode.ViewColumn\r\n\t): MermaidPreview {\r\n\t\tconst webviewPanel = vscode.window.createWebviewPanel(\r\n\t\t\tmermaidEditorViewType,\r\n\t\t\ttitle ?? vscode.l10n.t('Mermaid Diagram'),\r\n\t\t\tviewColumn,\r\n\t\t\t{\r\n\t\t\t\tretainContextWhenHidden: false,\r\n\t\t\t}\r\n\t\t);\r\n\r\n\t\treturn new MermaidPreview(webviewPanel, diagramId, mermaidSource, extensionUri, webviewManager);\r\n\t}\r\n\r\n\tpublic static revive(\r\n\t\twebviewPanel: vscode.WebviewPanel,\r\n\t\tdiagramId: string,\r\n\t\tmermaidSource: string,\r\n\t\textensionUri: vscode.Uri,\r\n\t\twebviewManager: MermaidWebviewManager\r\n\t): MermaidPreview {\r\n\t\treturn new MermaidPreview(webviewPanel, diagramId, mermaidSource, extensionUri, webviewManager);\r\n\t}\r\n\r\n\tprivate constructor(\r\n\t\tprivate readonly _webviewPanel: vscode.WebviewPanel,\r\n\t\tpublic readonly diagramId: string,\r\n\t\tprivate readonly _mermaidSource: string,\r\n\t\tprivate readonly _extensionUri: vscode.Uri,\r\n\t\tprivate readonly _webviewManager: MermaidWebviewManager\r\n\t) {\r\n\t\tsuper();\r\n\r\n\t\tthis._webviewPanel.iconPath = new vscode.ThemeIcon('graph');\r\n\r\n\t\tthis._webviewPanel.webview.options = {\r\n\t\t\tenableScripts: true,\r\n\t\t\tlocalResourceRoots: [\r\n\t\t\t\tvscode.Uri.joinPath(this._extensionUri, 'chat-webview-out')\r\n\t\t\t],\r\n\t\t};\r\n\r\n\t\tthis._webviewPanel.webview.html = this._getHtml();\r\n\r\n\t\t// Register with the webview manager\r\n\t\tthis._register(this._webviewManager.registerWebview(this.diagramId, this._webviewPanel.webview, this._mermaidSource, undefined, 'editor'));\r\n\r\n\t\tthis._register(this._webviewPanel.onDidChangeViewState(e => {\r\n\t\t\tif (e.webviewPanel.active) {\r\n\t\t\t\tthis._webviewManager.setActiveWebview(this.diagramId);\r\n\t\t\t}\r\n\t\t}));\r\n\r\n\t\tthis._register(this._webviewPanel.onDidDispose(() => {\r\n\t\t\tthis._onDisposeEmitter.fire();\r\n\t\t\tthis.dispose();\r\n\t\t}));\r\n\t}\r\n\r\n\tpublic reveal(): void {\r\n\t\tthis._webviewPanel.reveal();\r\n\t}\r\n\r\n\tpublic override dispose() {\r\n\t\tthis._onDisposeEmitter.fire();\r\n\r\n\t\tsuper.dispose();\r\n\r\n\t\tthis._webviewPanel.dispose();\r\n\t}\r\n\r\n\tprivate _getHtml(): string {\r\n\t\tconst nonce = generateUuid();\r\n\r\n\t\tconst mediaRoot = vscode.Uri.joinPath(this._extensionUri, 'chat-webview-out');\r\n\t\tconst scriptUri = this._webviewPanel.webview.asWebviewUri(\r\n\t\t\tvscode.Uri.joinPath(mediaRoot, 'index-editor.js')\r\n\t\t);\r\n\t\tconst codiconsUri = this._webviewPanel.webview.asWebviewUri(\r\n\t\t\tvscode.Uri.joinPath(mediaRoot, 'codicon.css')\r\n\t\t);\r\n\r\n\t\treturn /* html */`<!DOCTYPE html>\r\n\t\t\t<html lang=\"en\">\r\n\t\t\t<head>\r\n\t\t\t\t<meta charset=\"UTF-8\">\r\n\t\t\t\t<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n\t\t\t\t<title>Mermaid Diagram</title>\r\n\t\t\t\t<meta http-equiv=\"Content-Security-Policy\" content=\"default-src 'none'; script-src 'nonce-${nonce}'; style-src ${this._webviewPanel.webview.cspSource} 'unsafe-inline'; font-src data:;\" />\r\n\t\t\t\t<link rel=\"stylesheet\" type=\"text/css\" href=\"${codiconsUri}\">\r\n\t\t\t\t<style>\r\n\t\t\t\t\thtml, body {\r\n\t\t\t\t\t\tmargin: 0;\r\n\t\t\t\t\t\tpadding: 0;\r\n\t\t\t\t\t\theight: 100%;\r\n\t\t\t\t\t\twidth: 100%;\r\n\t\t\t\t\t\toverflow: hidden;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t.mermaid {\r\n\t\t\t\t\t\tvisibility: hidden;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t.mermaid.rendered {\r\n\t\t\t\t\t\tvisibility: visible;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t.mermaid-wrapper {\r\n\t\t\t\t\t\theight: 100%;\r\n\t\t\t\t\t\twidth: 100%;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t.zoom-controls {\r\n\t\t\t\t\t\tposition: absolute;\r\n\t\t\t\t\t\ttop: 8px;\r\n\t\t\t\t\t\tright: 8px;\r\n\t\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\t\tgap: 2px;\r\n\t\t\t\t\t\tz-index: 100;\r\n\t\t\t\t\t\tbackground: var(--vscode-editorWidget-background);\r\n\t\t\t\t\t\tborder: 1px solid var(--vscode-editorWidget-border);\r\n\t\t\t\t\t\tborder-radius: 6px;\r\n\t\t\t\t\t\tpadding: 3px;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t.zoom-controls button {\r\n\t\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\t\talign-items: center;\r\n\t\t\t\t\t\tjustify-content: center;\r\n\t\t\t\t\t\twidth: 26px;\r\n\t\t\t\t\t\theight: 26px;\r\n\t\t\t\t\t\tbackground: transparent;\r\n\t\t\t\t\t\tcolor: var(--vscode-icon-foreground);\r\n\t\t\t\t\t\tborder: none;\r\n\t\t\t\t\t\tborder-radius: 4px;\r\n\t\t\t\t\t\tcursor: pointer;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t.zoom-controls button:hover {\r\n\t\t\t\t\t\tbackground: var(--vscode-toolbar-hoverBackground);\r\n\t\t\t\t\t}\r\n\t\t\t\t</style>\r\n\t\t\t</head>\r\n\t\t\t<body data-vscode-context='${JSON.stringify({ preventDefaultContextMenuItems: true, mermaidWebviewId: this.diagramId })}' data-vscode-mermaid-webview-id=\"${this.diagramId}\">\r\n\t\t\t\t<div class=\"zoom-controls\">\r\n\t\t\t\t\t<button class=\"zoom-out-btn\" title=\"${vscode.l10n.t('Zoom Out')}\"><i class=\"codicon codicon-zoom-out\"></i></button>\r\n\t\t\t\t\t<button class=\"zoom-in-btn\" title=\"${vscode.l10n.t('Zoom In')}\"><i class=\"codicon codicon-zoom-in\"></i></button>\r\n\t\t\t\t\t<button class=\"zoom-reset-btn\" title=\"${vscode.l10n.t('Reset Zoom')}\"><i class=\"codicon codicon-screen-normal\"></i></button>\r\n\t\t\t\t</div>\r\n\t\t\t\t<pre class=\"mermaid\">\r\n\t\t\t\t\t${escapeHtmlText(this._mermaidSource)}\r\n\t\t\t\t</pre>\r\n\t\t\t\t<script type=\"module\" nonce=\"${nonce}\" src=\"${scriptUri}\"></script>\r\n\t\t\t</body>\r\n\t\t\t</html>`;\r\n\t}\r\n}\r\n\r\n\r\n/**\r\n * Generates a unique ID for a diagram based on its content.\r\n * This ensures the same diagram content always gets the same ID.\r\n */\r\nfunction getWebviewId(source: string): string {\r\n\t// Simple hash function for generating a content-based ID\r\n\tlet hash = 0;\r\n\tfor (let i = 0; i < source.length; i++) {\r\n\t\tconst char = source.charCodeAt(i);\r\n\t\thash = ((hash << 5) - hash) + char;\r\n\t\thash = hash & hash; // Convert to 32-bit integer\r\n\t}\r\n\treturn Math.abs(hash).toString(16);\r\n}\r\n"]}