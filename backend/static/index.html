<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Omni-IDE</title>
    <!-- Favicon to prevent 404 -->
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ¤–</text></svg>">
    <link rel="stylesheet" href="/static/styles.css?v=12">
</head>

<body>
    <!-- AUTHENTICATION GATE (First-Run Setup) -->
    <div id="auth-modal"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.92); z-index: 10000; justify-content: center; align-items: center; backdrop-filter: blur(8px);">
        <div
            style="background: #1e1e1e; padding: 40px; border-radius: 12px; width: 450px; text-align: center; border: 1px solid #333; box-shadow: 0 20px 60px rgba(0,0,0,0.8);">
            <div style="font-size: 42px; margin-bottom: 12px;">ðŸ¤–</div>
            <h2 style="color: #fff; margin-top: 0; font-size: 22px;">âš¡ Omni-IDE Setup</h2>
            <p style="color: #bbb; margin: 15px 0 25px 0; line-height: 1.6; font-size: 14px;">To activate the AI Agent,
                please enter your<br>Hugging Face API Token.</p>

            <input type="password" id="api-key-input" placeholder="Paste key here (hf_...)"
                style="width: 100%; padding: 14px; margin-bottom: 15px; background: #2d2d2d; border: 1px solid #444; color: white; border-radius: 8px; outline: none; box-sizing: border-box; font-size: 14px; font-family: monospace; transition: border-color 0.2s;"
                onfocus="this.style.borderColor='#007acc'" onblur="this.style.borderColor='#444'">

            <div id="auth-error" style="color: #ff6b6b; font-size: 12px; margin-bottom: 12px; display: none;"></div>

            <button id="auth-submit-btn" onclick="saveApiKey()"
                style="width: 100%; padding: 14px; background: linear-gradient(135deg, #007acc, #005f99); color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 15px; transition: all 0.3s; letter-spacing: 0.5px;"
                onmouseover="this.style.background='linear-gradient(135deg, #0098ff, #007acc)'"
                onmouseout="this.style.background='linear-gradient(135deg, #007acc, #005f99)'">
                Connect Agent ðŸš€
            </button>

            <div style="margin-top: 22px; font-size: 13px;">
                <a href="https://huggingface.co/settings/tokens" target="_blank"
                    style="color: #4daafc; text-decoration: none;">Get a free token here â†—</a>
            </div>
            <p style="color: #555; font-size: 11px; margin-top: 15px;">Your key is stored locally. We never see it.</p>
        </div>
    </div>

    <div id="app-container">
        <!-- PANE 1: File Explorer (15%) -->
        <div id="file-pane">
            <div id="file-header">EXPLORER</div>

            <!-- Folder Navigation -->
            <div id="folder-nav"
                style="padding: 10px; border-bottom: 1px solid #333; display: flex; flex-direction: column; gap: 5px;">
                <button id="change-dir-btn"
                    style="width: 100%; padding: 8px; background: #007acc; color: white; border: none; cursor: pointer; border-radius: 4px; font-size: 13px; font-weight: 600;">ðŸ“‚
                    Open Folder</button>
                <button id="close-dir-btn"
                    style="width: 100%; padding: 5px; background: #333; color: #ccc; border: 1px solid #444; cursor: pointer; border-radius: 4px; font-size: 11px; margin-top: 5px; display: none;">
                    Close Folder</button>
                <div id="current-path"
                    style="font-size: 10px; color: #888; word-break: break-all; font-family: monospace;"></div>
            </div>

            <div id="file-list">
                <!-- Javascript will populate this -->
            </div>
        </div>

        <!-- PANE 2: AI Chat Interface (25%) -->
        <div id="chat-pane">
            <div id="chat-header">
                <h2>Omni-Agent</h2>
                <div class="status-indicator online"></div>
            </div>
            <div id="chat-history">
                <div class="message assistant">
                    <div class="bubble">
                        Hello! I am your autonomous coding assistant. Open a folder and ask me to create, edit, or
                        manage files.
                    </div>
                </div>
            </div>
            <div id="chat-input-area">
                <textarea id="user-input" placeholder="Type a command..." rows="2" autocomplete="off"></textarea>
                <button id="send-btn">Send</button>
            </div>
        </div>

        <!-- PANE 3: Monaco Editor (60%) -->
        <div id="editor-pane">
            <div id="tab-bar">
                <!-- Javascript will populate tabs -->
            </div>
            <div id="editor-header">
                <div id="editor-toolbar-spacer"></div>
                <button id="run-btn">â–¶ Run Code</button>
            </div>
            <div id="editor-container"></div>
            <!-- OUTPUT TERMINAL -->
            <div id="terminal-pane">
                <div id="terminal-header">
                    <span>TERMINAL</span>
                    <span id="terminal-clear" title="Clear Output">ðŸš«</span>
                </div>
                <pre id="terminal-content">Waiting for output...</pre>
            </div>
        </div>
    </div>

    <!-- Monaco Editor Loader -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.33.0/min/vs/loader.min.js"></script>
    <!-- App Logic (cache-busted) -->
    <script src="/static/script.js?v=12"></script>
</body>

</html>